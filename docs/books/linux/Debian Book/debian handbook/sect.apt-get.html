<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>6.2. aptitude and apt-get Commands</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 3.0" /><meta name="package" content="Debian-debian-handbook-6.0-en-US-1.0-1" /><meta name="keywords" content="apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link rel="home" href="index.html" title="The Debian Administrator's Handbook" /><link rel="up" href="apt.html" title="Chapter 6. Maintenance and Updates: The APT Tools" /><link rel="prev" href="apt.html" title="Chapter 6. Maintenance and Updates: The APT Tools" /><link rel="next" href="sect.apt-cache.html" title="6.3. The apt-cache Command" /></head><body><p class="hidden" id="title"><a class="left" href="http://www.debian.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://debian-handbook.info"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="apt.html"><strong>Prev</strong></a></li><li class="home">The Debian Administrator's Handbook</li><li class="next"><a accesskey="n" href="sect.apt-cache.html"><strong>Next</strong></a></li></ul><div class="section"><div class="titlepage"><div><div><h2 class="title" id="sect.apt-get">6.2. <code class="command">aptitude</code> and <code class="command">apt-get</code> Commands</h2></div></div></div><a id="idp13283000" class="indexterm"></a><a id="idp13283560" class="indexterm"></a><div class="para"><p></p>
			APT is a vast project, whose original plans included a graphical interface. It is based on a library which contains the core application, and <code class="command">apt-get</code> is the first interface — command-line based — which was developed within the project.
		</div><div class="para"><p></p>
			Numerous other graphical interfaces then appeared as external projects: <code class="command">synaptic</code>, <code class="command">aptitude</code> (which includes both a text mode interface and a graphical one — even if not complete yet), <code class="command">wajig</code>, etc. The most recommended interface, <code class="command">aptitude</code>, is the one used during the installation of Debian. Since its command-line syntax is very similar to <code class="command">apt-get</code>'s, we will be focusing on <code class="command">aptitude</code> in the examples given in this section. When there are major differences between <code class="command">aptitude</code> and <code class="command">apt-get</code>, these differences will be detailed.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp13287264">6.2.1. Initialization</h3></div></div></div><div class="para"><p></p>
				For any work with APT, the list of available packages needs to be updated; this can be done simply through <code class="command">aptitude update</code>. Depending on the speed of your connection, the operation can take a while since it involves downloading a certain number of <code class="filename">Packages.(gz|bz2)</code> files (or even <code class="filename">Sources.(gz|bz2)</code>), which have gradually become bigger and bigger as Debian has developed (more than 8 MB for the largest <code class="filename">Packages.gz</code> — from the <code class="literal">main</code> section). Of course, installing from a CD-ROM set does not require any downloading — in this case, the operation is very fast.
			</div><a id="idp13289456" class="indexterm"></a><a id="idp13290000" class="indexterm"></a></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp13290624">6.2.2. Installing and Removing</h3></div></div></div><a id="idp13291008" class="indexterm"></a><a id="idp13291712" class="indexterm"></a><a id="idp13292432" class="indexterm"></a><a id="idp13293136" class="indexterm"></a><div class="para"><p></p>
				With APT, packages can be added or removed from the system, respectively with <code class="command">aptitude install <em class="replaceable"><code>package</code></em></code> and <code class="command">aptitude remove <em class="replaceable"><code>package</code></em></code>. In both cases, APT will automatically install the necessary dependencies or delete the packages which depend on the package that is being removed. The <code class="command">aptitude purge <em class="replaceable"><code>package</code></em></code> or <code class="command">apt-get purge <em class="replaceable"><code>package</code></em></code> commands involve a complete uninstallation — the configuration files are also deleted.
			</div><a id="idp13295680" class="indexterm"></a><a id="idp13296224" class="indexterm"></a><a id="idp13296768" class="indexterm"></a><a id="idp13297312" class="indexterm"></a><a id="idp13297856" class="indexterm"></a><a id="idp13298400" class="indexterm"></a><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> Installing the same selection of packages several times</h6></div></div></div><div class="para"><p></p>
				It can be useful to systematically install the same list of packages on several computers. This can be done quite easily.
			</div><div class="para"><p></p>
				First, retrieve the list of packages installed on the computer which will serve as the “model” to copy.
			</div><pre class="screen"><code class="computeroutput">$ </code><strong class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong></pre><div class="para"><p></p>
				The <code class="filename">pkg-list</code> file then contains the list of installed packages. Next, transfer the <code class="filename">pkg-list</code> file on the computers you want to update and use the following commands:
			</div><pre class="screen"><code class="computeroutput"># </code><strong class="userinput"><code>dpkg --set-selections &lt;pkg-list</code></strong>
<code class="computeroutput"># </code><strong class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div class="para"><p></p>
				The first command registers the list of packages you wish to install, then the <code class="command">apt-get</code> invocation executes the required operations! <code class="command">aptitude</code> does not have this command.
			</div></div><div class="sidebar important"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> Removing and installing at the same time</h6></div></div></div><div class="para"><p></p>
				It is possible to ask <code class="command">aptitude</code> (or <code class="command">apt-get</code>) to install certain packages and remove others on the same command line by adding a suffix. With an <code class="command">aptitude install</code> command, add “<code class="literal">-</code>” to the names of the packages you wish to remove. With an <code class="command">aptitude remove</code> command, add “<code class="literal">+</code>” to the names of the packages you wish to install.
			</div><div class="para"><p></p>
				The next example shows two different ways to install <em class="replaceable"><code>package1</code></em> and to remove <em class="replaceable"><code>package2</code></em>.
			</div><pre class="screen"><code class="computeroutput"># </code><strong class="userinput"><code>aptitude install <em class="replaceable"><code>package1</code></em> <em class="replaceable"><code>package2-</code></em></code></strong>
[...]
<code class="computeroutput"># </code><strong class="userinput"><code>aptitude remove <em class="replaceable"><code>package1+</code></em> <em class="replaceable"><code>package2</code></em></code></strong>
[...]
</pre></div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> <code class="command">apt-get --reinstall</code> and <code class="command">aptitude reinstall</code></h6></div></div></div><a id="idp13309512" class="indexterm"></a><div class="para"><p></p>
				The system can sometimes be damaged after the removal or modification of files in a package. The easiest way to retrieve these files is to reinstall the affected package. Unfortunately, the packaging system finds that the latter is already installed and politely refuses to reinstall it; to avoid this, use the <code class="literal">--reinstall</code> option of the <code class="command">apt-get</code> command. The following command reinstalls <span class="pkg pkg">postfix</span> even if it is already present:
			</div><pre class="screen"><code class="computeroutput"># </code><strong class="userinput"><code>apt-get --reinstall install postfix</code></strong></pre><div class="para"><p></p>
				The <code class="command">aptitude</code> command line is slightly different, but achieves the same result with <code class="command">aptitude reinstall postfix</code>.
			</div><div class="para"><p></p>
				The problem does not arise with <code class="command">dpkg</code>, but the administrator rarely uses it directly.
			</div><div class="para"><p></p>
				Be careful, using <code class="command">apt-get --reinstall</code> to restore packages modified during an attack certainly cannot recover the system as it was. <a class="xref" href="sect.dealing-with-compromised-machine.html">Section 14.6, “Dealing with a Compromised Machine”</a> details the necessary steps to take with a hacked system.
			</div></div><div class="para"><p></p>
				If the file <code class="filename">sources.list</code> mentions several distributions, it is possible to give the version of the package to install. A specific version number can be requested with <code class="command">aptitude install <em class="replaceable"><code>package</code></em>=<em class="replaceable"><code>version</code></em></code>, but indicating its distribution of origin (<span class="distribution distribution">Stable</span>, <span class="distribution distribution">Testing</span> or <span class="distribution distribution">Unstable</span>) — with <code class="command">aptitude install <em class="replaceable"><code>package</code></em>/<em class="replaceable"><code>distribution</code></em></code> — is usually preferred. With this command, it is possible to go back to an older version of a package (if for instance you know that it works well), provided that it is still available in one of the sources referenced by the <code class="filename">sources.list</code> file. Otherwise the <code class="literal">snapshot.debian.org</code> archive can come to the rescue (see sidebar <a class="xref" href="apt.html#cadre.snapshot.debian.org"><span class="emphasis"><em>GOING FURTHER</em></span> Old package versions: <code class="literal">snapshot.debian.org</code></a>).
			</div><div class="example"><h6>Example 6.2. Installation of the <span class="distribution distribution">unstable</span> version of <span class="pkg pkg">spamassassin</span></h6><div class="example-contents"><pre class="screen"><code class="computeroutput"># </code><strong class="userinput"><code>aptitude install spamassassin/unstable</code></strong></pre></div></div><br class="example-break" /><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> The cache of <code class="filename">.deb</code> files</h6></div></div></div><div class="para"><p></p>
				APT keeps a copy of each downloaded <code class="filename">.deb</code> file in the directory <code class="filename">/var/cache/apt/archives/</code>. In case of frequent updates, this directory can quickly take a lot of disk space with several versions of each package; you should regularly sort through them. Two commands can be used: <code class="command">aptitude clean</code> entirely empties the directory; <code class="command">aptitude autoclean</code> only removes packages which cannot be downloaded (because they have disappeared from the Debian mirror) and are therefore clearly useless (the configuration parameter <code class="literal">APT::Clean-Installed</code> can prevent the removal of <code class="filename">.deb</code> files that are currently installed).
			</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="section.apt-mise-a-jour">6.2.3. System Upgrade</h3></div></div></div><a id="idp13323080" class="indexterm"></a><div class="para"><p></p>
				Regular upgrades are recommended, because they include the latest security updates. To upgrade, use <code class="command">aptitude safe-upgrade</code> or <code class="command">apt-get upgrade</code> (of course after <code class="command">aptitude update</code>). This command looks for installed packages which can be upgraded without removing any packages. In other words, the goal is to ensure the least intrusive upgrade possible. <code class="command">apt-get</code> is slightly more demanding than <code class="command">aptitude</code> because it will refuse to install packages which were not installed beforehand.
			</div><div class="sidebar fil"><a xmlns="" id="encadre.apt-pdiff"></a><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> Incremental upgrade</h6></div></div></div><div class="para"><p></p>
				As we explained earlier, the aim of the <code class="command">aptitude update</code> command is to download for each package source the corresponding <code class="filename">Packages</code> (or <code class="filename">Sources</code>) file. However, even after a <code class="command">bzip2</code> compression, these files can remain rather large (the <code class="filename">Packages.bz2</code> for the <span class="foreignphrase"><em class="foreignphrase">main</em></span> section of <span class="distribution distribution">Squeeze</span> takes more than 8 MB). If you wish to upgrade regularly, these downloads can take up a lot of time.
			</div><div class="para"><p></p>
				A “new feature” (available since <span class="distribution distribution">Etch</span>) is that APT can now download the changes since the previous update, as opposed to the entire file. To achieve this, official Debian mirrors distribute different files which list the differences between one version of the <code class="filename">Packages</code> file and the following version. They are generated at each update of the archives and a history of one week is kept. Each of these “diff” files only takes a few dozen kilobytes for <span class="distribution distribution">Unstable</span>, so that the amount of data downloaded by a weekly <code class="command">aptitude update</code> is often divided by 10. For distributions like <span class="distribution distribution">Stable</span> and <span class="distribution distribution">Testing</span>, which change less, the gain is even more noticeable.
			</div><div class="para"><p></p>
				However, it can sometimes be of interest to force the download of the entire <code class="filename">Packages.bz2</code> file, especially when the last upgrade is very old and when the mechanism of incremental differences would not contribute much. This can also be interesting when network access is very fast but when the processor of the machine to upgrade is rather slow, since the time saved on the download is more than lost when the computer calculates the new versions of these files (starting with the older versions and applying the downloaded differences). To do that, you can use the configuration parameter <code class="literal">Acquire::Pdiffs</code> and set it to <code class="literal">false</code>.
			</div></div><div class="para"><p></p>
				<code class="command">aptitude</code> will generally select the most recent version number (except for <span class="distribution distribution">Experimental</span> packages, which are ignored by default whatever their version number). If you specified <span class="distribution distribution">Testing</span> or <span class="distribution distribution">Unstable</span> in your <code class="filename">sources.list</code>, <code class="command">aptitude safe-upgrade</code> will switch most of your <span class="distribution distribution">Stable</span> system to <span class="distribution distribution">Testing</span> or <span class="distribution distribution">Unstable</span>, which might not be what you intended.
			</div><div class="para"><p></p>
				To tell <code class="command">aptitude</code> to use a specific distribution when searching for upgraded packages, you need to use the option <code class="literal">-t</code> or <code class="literal">--target-release</code>, followed by the name of the distribution you want (for example: <code class="command">aptitude -t stable safe-upgrade</code>). To avoid specifying this option every time you use <code class="command">aptitude</code>, you can add <code class="literal">APT::Default-Release "stable";</code> in the file <code class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a id="idp13338248" class="indexterm"></a><a id="idp13338792" class="indexterm"></a><div class="para"><p></p>
				For more important upgrades, such as the change from one major Debian versionto the next, you need to use <code class="command">aptitude full-upgrade</code> (the option used to be named <code class="literal">dist-upgrade</code>, for “distribution upgrade”). With this instruction, <code class="command">aptitude</code> will complete the upgrade even if it has to remove some obsolete packages or install new dependencies. This is also the command used by users who work daily with the Debian <span class="distribution distribution">Unstable</span> release and follow its evolution day by day. It is so simple that it hardly needs explanation: APT's reputation is based on this great functionality.
			</div><div class="para"><p></p>
				<code class="command">aptitude dist-upgrade</code> is still available as a synonym for <code class="command">aptitude full-upgrade</code>; <code class="command">apt-get</code> only recognizes the former.
			</div><a id="idp13342064" class="indexterm"></a><a id="idp13342608" class="indexterm"></a><a id="idp13343152" class="indexterm"></a></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp13343776">6.2.4. Configuration Options</h3></div></div></div><a id="idp13344160" class="indexterm"></a><a id="idp13344864" class="indexterm"></a><a id="idp13345424" class="indexterm"></a><div class="para"><p></p>
				Besides the configuration elements already mentioned, it is possible to configure certain aspects of APT by adding directives in a file of the <code class="filename">/etc/apt/apt.conf.d/</code> directory. Remember for instance that it is possible for APT to tell <code class="command">dpkg</code> to ignore file conflict errors by specifying <code class="literal">DPkg::Options { "--force-overwrite"; }</code>.
			</div><div class="para"><p></p>
				If the Web can only be accessed through a proxy, add a line like <code class="literal">Acquire::http::proxy "http://<em class="replaceable"><code>yourproxy</code></em>:3128"</code>. For an FTP proxy, write <code class="literal">Acquire::ftp::proxy "ftp://<em class="replaceable"><code>yourproxy</code></em>"</code>. To discover more configuration options, read the <span class="citerefentry"><span class="refentrytitle">apt.conf</span>(5)</span> manual page with the command <code class="command">man apt.conf</code> (for details on manual pages, see next chapter).
			</div><div class="sidebar"><a xmlns="" id="cadre-repertoire.d"></a><div class="titlepage"><div><div><h6><span class="emphasis"><em>BACK TO BASICS</em></span> Directories ending in <code class="filename">.d</code></h6></div></div></div><a id="idp13350088" class="indexterm"></a><div class="para"><p></p>
				Directories with a <code class="filename">.d</code> suffix are used more and more often. Each directory represents a configuration file which is split over multiple files. In this sense, all of the files in <code class="filename">/etc/apt/apt.conf.d/</code> are instructions for the configuration of APT. APT includes them in alphabetical order, so that the last ones can modify a configuration element defined in one of the first ones.
			</div><div class="para"><p></p>
				This structure brings some flexibility to the machine administrator and to the package maintainers. Indeed, the administrator can easily modify the configuration of the software by adding a ready-made file in the directory in question without having to change an existing file. Package maintainers use the same approach when they need to adapt the configuration of another software to ensure that it perfectly co-exists with theirs. However, the Debian policy explicitly forbids modifying configuration files of other packages — only users are allowed to do this. Remember that during a package upgrade, the user gets to choose the version of the configuration file that should be kept when a modification has been detected. Any external modification of the file would trigger that request, which would disturb the administrator, who is sure not to have changed anything.
			</div><div class="para"><p></p>
				Without a <code class="filename">.d</code> directory, it is impossible for an external package to change the settings of a program without modifying its configuration file. Instead it must invite the user to do it himself and lists the operations to be done in the file <code class="filename">/usr/share/doc/<em class="replaceable"><code>package</code></em>/README.Debian</code>.
			</div><div class="para"><p></p>
				Depending on the application, the <code class="filename">.d</code> directory is used directly or managed by an external script which will concatenate all the files to create the configuration file itself. It is important to execute the script after any change in that directory so that the most recent modifications are taken into account. In the same way, it is important not to work directly in the configuration file created automatically, since everything would be lost at the next execution of the script. Choosing one method (<code class="filename">.d</code> directory used directly or a file generated from that directory) is usually imposed by implementation constraints, but in both cases the gains in terms of configuration flexibility more than make up for the small complications that they entail. The Exim 4 mail server is an example of the generated file method: it can be configured through several files (<code class="filename">/etc/exim4/conf.d/*</code>) which are concatenated into <code class="filename">/var/lib/exim4/config.autogenerated</code> by the <code class="command">update-exim4.conf</code> command.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp13356304">6.2.5. Managing Package Priorities</h3></div></div></div><div class="para"><p></p>
				One of the most important aspects in the configuration of APT is the management of the priorities associated with each package source. For instance, you might want to extend one distribution with one or two newer packages from <span class="distribution distribution">Testing</span>, <span class="distribution distribution">Unstable</span> or <span class="distribution distribution">Experimental</span>. It is possible to assign a priority to each available package (the same package can have several priorities depending on its version or the distribution providing it). These priorities will influence APT's behavior: for each package, it will always select the version with the highest priority (except if this version is older than the installed one and if its priority is less than 1000).
			</div><a id="idp13358656" class="indexterm"></a><a id="idp13359440" class="indexterm"></a><a id="idp13360160" class="indexterm"></a><a id="idp13360880" class="indexterm"></a><a id="idp13361440" class="indexterm"></a><div class="para"><p></p>
				APT defines several default priorities. Each installed package version has a priority of 100. A non-installed version has a priority of 500 by default, but it can jump to 990 if it is part of the target release (defined with the <code class="literal">-t</code> command-line option or the <code class="literal">APT::Target-Release</code> configuration directive).
			</div><div class="para"><p></p>
				You can modify the priorities by adding entries in the file <code class="filename">/etc/apt/preferences</code> with the names of the affected packages, their version, their origin and their new priority.
			</div><div class="para"><p></p>
				APT will never install an older version of a package (that is, a package whose version number is lower than the one of the currently installed package) except if its priority is higher than 1000. APT will always install the highest priority package which follows this constraint. If two packages have the same priority, APT installs the newest one (whose version number is the highest). If two packages of same version have the same priority but differ in their content, APT installs the version that is not installed (this rule has been created to cover the case of a package update without the increment of the revision number, which is usually required).
			</div><div class="para"><p></p>
				In more concrete terms, a package whose priority is less than 0 will never be installed. A package with a priority ranging between 0 and 100 will only be installed if no other version of the package is already installed. With a priority between 100 and 500, the package will only be installed if there is no other newer version installed or available in another distribution. A package of priority between 500 and 990 will only be installed if there is no newer version installed or available in the target distribution. With a priority between 990 and 1000, the package will be installed except if the installed version is newer. A priority greater than 1000 will always lead to the installation of the package even if it forces APT to downgrade to an older version.
			</div><div class="para"><p></p>
				When APT checks <code class="filename">/etc/apt/preferences</code>, it first takes into account the most specific entries (often those specifying the concerned package), then the more generic ones (including for example all the packages of a distribution). If several generic entries exist, the first match is used. The available selection criteria include the package's name and the source providing it. Every package source is identified by the information contained in a <code class="filename">Release</code> file that APT downloads together with the <code class="filename">Packages.gz</code> files. It specifies the origin (usually “Debian” for the packages of official mirrors, but it can also be a person's or an organization's name for third-parties repositories). It also gives the name of the distribution (usually <span class="distribution distribution">Stable</span>, <span class="distribution distribution">Testing</span>, <span class="distribution distribution">Unstable</span> or <span class="distribution distribution">Experimental</span> for the standard distributions provided by Debian) together with its version (for example 5.0 for Debian <span class="distribution distribution">Lenny</span>). Let's have a look at its syntax through some realistic case studies of this mechanism.
			</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>SPECIFIC CASE</em></span> Priority of <span class="distribution distribution">experimental</span></h6></div></div></div><a id="idp13369880" class="indexterm"></a><div class="para"><p></p>
				If you listed <span class="distribution distribution">Experimental</span> in your <code class="filename">sources.list</code> file, the corresponding packages will almost never be installed because their default APT priority is 1. This is of course a specific case, designed to keep users from installing <span class="distribution distribution">Experimental</span> packages by mistake. The packages can only be installed by typing <code class="command">aptitude install <em class="replaceable"><code>package</code></em>/experimental</code> — users typing this command can only be aware of the risks that they take. It is still possible (though <span class="emphasis"><em>not</em></span> recommended) to treat packages of <span class="distribution distribution">Experimental</span> like those of other distributions by giving them a priority of 500. This is done with a specific entry in <code class="filename">/etc/apt/preferences</code>:
			</div><div class="informalexample"><pre class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div><div class="para"><p></p>
				Let's suppose that you only want to use packages from the stable version of Debian. Those provided in other versions should not be installed except if explicitly requested. You could write the following entries in the <code class="filename">/etc/apt/preferences</code> file:
			</div><div class="informalexample"><pre class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10
</pre></div><div class="para"><p></p>
				<code class="literal">a=stable</code> defines the name of the selected distribution. <code class="literal">o=Debian</code> limits the scope to packages whose origin is “Debian”.
			</div><div class="para"><p></p>
				Let's now assume that you have a server with several local programs depending on the version 5.10 of Perl and that you want to ensure that upgrades will not install another version of it. You could use this entry:
			</div><div class="informalexample"><pre class="programlisting">Package: perl
Pin: version 5.10*
Pin-Priority: 1001
</pre></div><div class="para"><p></p>
				The reference documentation for this configuration file is available in the manual page <span class="citerefentry"><span class="refentrytitle">apt_preferences</span>(5)</span>, which you can display with <code class="command">man apt_preferences</code>.
			</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> Comments in <code class="filename">/etc/apt/preferences</code></h6></div></div></div><a id="idp13378800" class="indexterm"></a><a id="idp13379360" class="indexterm"></a><a id="idp13379920" class="indexterm"></a><div class="para"><p></p>
				There is no official syntax to put comments in the <code class="filename">/etc/apt/preferences</code> file, but some textual descriptions can be provided by putting one or more “<code class="literal">Explanation</code>” fields at the start of each entry:
			</div><div class="informalexample"><pre class="programlisting">Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="section.apt-mix-distros">6.2.6. Working with Several Distributions</h3></div></div></div><div class="para"><p></p>
				<code class="command">aptitude</code> being such a marvelous tool, it is tempting to pick packages coming from other distributions. For example, after having installed a <span class="distribution distribution">Stable</span> system, you might want to try out a software available in <span class="distribution distribution">Testing</span> or <span class="distribution distribution">Unstable</span> without diverging too much from the system's initial state.
			</div><div class="para"><p></p>
				Even if you will occasionnaly encounter problems while mixing packages from different distributions, <code class="command">aptitude</code> manages such coexistence very well and limits risks very effectively. The best way to proceed is to list all distributions used in <code class="filename">/etc/apt/sources.list</code> (some people always put the three distributions, but remember that <span class="distribution distribution">Unstable</span> is reserved for experienced users) and to define your reference distribution with the <code class="literal">APT::Default-Release</code> parameter (see <a class="xref" href="sect.apt-get.html#section.apt-mise-a-jour">Section 6.2.3, “System Upgrade”</a>).
			</div><div class="para"><p></p>
				Let's suppose that <span class="distribution distribution">Stable</span> is your reference distribution but that <span class="distribution distribution">Testing</span> and <span class="distribution distribution">Unstable</span> are also listed in your <code class="filename">sources.list</code> file. In this case, you can use <code class="command">aptitude install <em class="replaceable"><code>package</code></em>/testing</code> to install a package from <span class="distribution distribution">Testing</span>. If the installation fails due to some unsatisfiable dependencies, let it solve those dependencies within <span class="distribution distribution">Testing</span> by adding the <code class="literal">-t testing</code> parameter. The same obviously applies to <span class="distribution distribution">Unstable</span>.
			</div><div class="para"><p></p>
				In this situation, upgrades (<code class="command">safe-upgrade</code> and <code class="command">dist-upgrade</code>) are done within <span class="distribution distribution">Stable</span> except for packages already upgraded to an other distribution: those will follow updates available in the other distributions. We'll explain this behavior with the help of the default priorities set by APT below. Do not hesitate to use <code class="command">apt-cache policy</code> (see sidebar) to verify the given priorities.
			</div><div class="para"><p></p>
				Everything centers around the fact that APT only considers packages of higher or equal version than the installed one (assuming that <code class="filename">/etc/apt/preferencs</code> has not been used to force priorities higher than 1000 for some packages).
			</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> <code class="command">apt-cache policy</code></h6></div></div></div><div class="para"><p></p>
				To gain a better understanding of the mechanism of priority, do not hesitate to execute <code class="command">apt-cache policy</code> to display the default priority associated with each package source. You can also use <code class="command">apt-cache policy <em class="replaceable"><code>package</code></em></code> to display the priorities of all available versions of a given package.
			</div></div><div class="para"><p></p>
				Let's assume that you have installed version 1 of a first package from <span class="distribution distribution">Stable</span> and that version 2 and 3 are available respectively in <span class="distribution distribution">Testing</span> and <span class="distribution distribution">Unstable</span>. The installed version has a priority of 100 but the version available in <span class="distribution distribution">Stable</span> (the very same) has a priority of 990 (because it is part of the target release). Packages in <span class="distribution distribution">Testing</span> and <span class="distribution distribution">Unstable</span> have a priority of 500 (the default priority of a non-installed version). The winner is thus version 1 with a priority of 990. The package “stays in <span class="distribution distribution">Stable</span>”.
			</div><div class="para"><p></p>
				Let's take the example of another package whose version 2 has been installed from <span class="distribution distribution">Testing</span>. Version 1 is available in <span class="distribution distribution">Stable</span> and version 3 in <span class="distribution distribution">Unstable</span>. Version 1 (of priority 990 — thus lower than 1000) is discarded because it is lower than the installed version. This only leaves version 2 and 3, both of priority 500. Faced with this alternative, APT selects the newest version, the one from <span class="distribution distribution">Unstable</span>.If you don't want a package installed from <span class="distribution distribution">Testing</span> to migrate to <span class="distribution distribution">Unstable</span>, you have to assign a priority lower than 500 (490 for example) to packages coming from <span class="distribution distribution">Unstable</span>. You can modify <code class="filename">/etc/apt/preferences</code> to this effect:
			</div><pre class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490
</pre></div></div><div id="site_footer"></div><script type="text/javascript">
		$("#site_footer").load("../../../../../footer.html");
	</script><ul class="docnav"><li class="previous"><a accesskey="p" href="apt.html"><strong>Prev</strong>Chapter 6. Maintenance and Updates: The APT Tools</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="sect.apt-cache.html"><strong>Next</strong>6.3. The apt-cache Command</a></li></ul></body></html>
