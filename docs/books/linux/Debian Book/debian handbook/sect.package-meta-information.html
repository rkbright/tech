<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.2. Package Meta-Information</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 3.0" /><meta name="package" content="Debian-debian-handbook-6.0-en-US-1.0-1" /><meta name="keywords" content="Binary package, Source package, dpkg, dependencies, conflict" /><link rel="home" href="index.html" title="The Debian Administrator's Handbook" /><link rel="up" href="packaging-system.html" title="Chapter 5. Packaging System: Tools and Fundamental Principles" /><link rel="prev" href="packaging-system.html" title="Chapter 5. Packaging System: Tools and Fundamental Principles" /><link rel="next" href="sect.source-package-structure.html" title="5.3. Structure of a Source Package" /></head><body><p class="hidden" id="title"><a class="left" href="http://www.debian.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://debian-handbook.info"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="packaging-system.html"><strong>Prev</strong></a></li><li class="home">The Debian Administrator's Handbook</li><li class="next"><a accesskey="n" href="sect.source-package-structure.html"><strong>Next</strong></a></li></ul><div class="section"><div class="titlepage"><div><div><h2 class="title" id="sect.package-meta-information">5.2. Package Meta-Information</h2></div></div></div><a id="idp4969944" class="indexterm"></a><a id="idp4970408" class="indexterm"></a><div class="para"><p></p>
			The Debian package is not only an archive of files intended for installation. It is part of a larger whole, and it describes its relationship with other Debian packages (dependencies, conflicts, suggestions). It also provides scripts that enable the execution of commands at different stages in the package's lifecycle (installation, removal, upgrades). These data used by the package management tools are not part of the packaged software, but are, within the package, what is called its “meta-information” (information about other information).
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="section.control">5.2.1. Description: the <code class="filename">control</code> File</h3></div></div></div><a id="idp4972608" class="indexterm"></a><a id="idp4973072" class="indexterm"></a><a id="idp4973776" class="indexterm"></a><div class="para"><p></p>
				This file uses a structure similar to email headers (as defined by RFC 2822). For example, for <span class="pkg pkg">apt</span>, the <code class="filename">control</code> file looks like the following:
			</div><pre class="screen">
<code class="computeroutput">$ </code><strong class="userinput"><code>apt-cache show apt</code></strong>
<code class="computeroutput">Package: apt
Priority: important
Section: admin
Installed-Size: 5612
Maintainer: APT Development Team &lt;deity@lists.debian.org&gt;
Architecture: i386
Version: 0.8.0
Replaces: manpages-pl (&lt;&lt; 20060617-3~)
Provides: libapt-pkg4.10
Depends: libc6 (&gt;= 2.3.4), libgcc1 (&gt;= 1:4.1.1), libstdc++6 (&gt;= 4.4.0), zlib1g (&gt;= 1:1.1.4), debian-archive-keyring, gnupg
Suggests: aptitude | synaptic | wajig, dpkg-dev, apt-doc, bzip2, lzma, python-apt
Conflicts: python-apt (&lt;&lt; 0.7.93.2~)
Filename: pool/main/a/apt/apt_0.8.0_i386.deb
Size: 1965454
MD5sum: 43364819b898e49b8175e88ec5787241
SHA1: 350a8a7a43fe182d54f3b7d73b8032f85b5d7ddf
SHA256: a593e7d7f9b3cffa37770201a3c13bd2c8bc588bafbf39b4aaa5e13b5fb00b8b
Description: Advanced front-end for dpkg
 This is Debian's next generation front-end for the dpkg package manager.
 It provides the apt-get utility and APT dselect method that provides a
 simpler, safer way to install and upgrade packages.
 .
 APT features complete installation ordering, multiple source capability
 and several other unique features, see the Users Guide in apt-doc.
Tag: admin::package-management, hardware::storage, hardware::storage:cd, interface::commandline, network::client, protocol::{ftp,http,ipv6}, role::program, suite::debian, use::downloading, use::searching, works-with::software:package</code></pre><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>BACK TO BASICS</em></span> RFC — Internet standards</h6></div></div></div><a id="idp4977808" class="indexterm"></a><a id="idp4978288" class="indexterm"></a><div class="para"><p></p>
				RFC is the abbreviation of “Request For Comments”. An RFC is generally a technical document that describes what will become an Internet standard. Before becoming standardized and frozen, these standards are submitted for public review (hence their name). The IETF (Internet Engineering Task Force) decides on the evolution of the status of these documents (proposed standard, draft standard, or standard).
			</div><div class="para"><p></p>
				RFC 2026 defines the process for standardization of Internet protocols. <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.faqs.org/rfcs/rfc2026.html">http://www.faqs.org/rfcs/rfc2026.html</a></div>
			</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp4980128">5.2.1.1. Dependencies: the <code class="literal">Depends</code> Field</h4></div></div></div><a id="idp4980752" class="indexterm"></a><a id="idp4981232" class="indexterm"></a><a id="idp4981856" class="indexterm"></a><div class="para"><p></p>
					The dependencies are defined in the <code class="literal">Depends</code> field in the package header. This is a list of conditions to be met for the package to work correctly — this information is used by tools such as <code class="command">apt</code> in order to install the required libraries, in their appropriate versions, that the program to be installed depends on. For each dependency, it is possible to restrict the range of versions that meet that condition. In other words, it is possible to express the fact that we need the package <span class="pkg pkg">libc6</span> in a version equal to or greater than “2.3.4” (written “<code class="command">libc6 (&gt;= 2.3.4)</code>”). Version comparison operators are as follows:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para"><p></p>
							<code class="command">&lt;&lt;</code>: less than;
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">&lt;=</code>: less than or equal to;
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">=</code>: equal to (note, “<code class="literal">2.6.1</code>” is not equal to “<code class="literal">2.6.1-1</code>”);
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">&gt;=</code>: greater than or equal to;
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">&gt;&gt;</code>: greater than.
						</div></li></ul></div><div class="para"><p></p>
					In a list of conditions to be met, the comma serves as a separator. In logic, its meaning would be interpreted as “and”. In conditions, the vertical bar (“|”) expresses “or” in logic (it is an inclusive “or”, as opposed to meaning “either/or”). Carrying greater priority than “and”, it can be used as many times as necessary. Thus, the dependency “(A or B) and C” is written <code class="command">A | B, C</code>. In contrast, the expression “A or (B and C)” should be written as “(A or B) and (A or C)”, since the <code class="literal">Depends</code> field does not tolerate parentheses that change the order of priorities between the logical operators “or” and “and”. It would thus be written <code class="command">A | B, A | C</code>. <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.debian.org/doc/debian-policy/ch-relationships.html">http://www.debian.org/doc/debian-policy/ch-relationships.html</a></div>
				</div><a id="idp10135920" class="indexterm"></a><div class="para"><p></p>
					The dependencies system is a good mechanism for guaranteeing the operation of a program, but it has another use with “meta-packages”. These are empty packages that only describe dependencies. They facilitate the installation of a consistent group of programs preselected by the meta-package maintainer; as such, <code class="command">apt-get install <em class="replaceable"><code>meta-package</code></em></code> will automatically install all of these programs using the meta-package's dependencies. The <span class="pkg pkg">gnome</span>, <span class="pkg pkg">kde</span> and <span class="pkg pkg">linux-image-2.6-686</span> packages are examples of meta-packages.
				</div><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>DEBIAN POLICY</em></span> <code class="literal">Pre-Depends</code>, a more demanding <code class="literal">Depends</code> </h6></div></div></div><a id="idp10139752" class="indexterm"></a><a id="idp10140376" class="indexterm"></a><div class="para"><p></p>
					“Pre-dependencies”, which are listed in the “<code class="literal">Pre-Depends</code>” field in the package headers, complete the normal dependencies; their syntax is identical. A normal dependency indicates that the package in question must be unpacked and configured before the package declaring the dependency. A pre-dependency stipulates that the package in question must be unpacked and configured before execution of the pre-installation script of the package declaring the pre-dependency, that is before its installation.
				</div><div class="para"><p></p>
					A pre-dependency is very demanding for <code class="command">apt</code>, because it adds a strict constraint on the ordering of the packages to install. As such, pre-dependencies are discouraged unless absolutely necessary. It is even recommended to consult other developers on <code class="email"><a class="email" href="mailto:debian-devel@lists.debian.org">debian-devel@lists.debian.org</a></code> before adding a pre-dependency. It is generally possible to find another solution as a work-around.
				</div></div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>DEBIAN POLICY</em></span> <code class="literal">Recommends</code>, <code class="literal">Suggests</code>, and <code class="literal">Enhances</code> fields</h6></div></div></div><a id="idp10144232" class="indexterm"></a><a id="idp10144856" class="indexterm"></a><div class="para"><p></p>
					The <code class="literal">Recommends</code> and <code class="literal">Suggests</code> fields describe dependencies that are not compulsory. The “recommended” dependencies, the most important, considerably improve the functionality offered by the package but are not indispensable to its operation. The “suggested” dependencies, of secondary importance, indicate that certain packages may complement and increase their respective utility, but it is perfectly reasonable to install one without the others.
				</div><div class="para"><p></p>
					You should always install the “recommended” packages, unless you know exactly why you do not need them. Conversely, it is not necessary to install “suggested” packages unless you know why you need them.
				</div><a id="idp4140808" class="indexterm"></a><div class="para"><p></p>
					The <code class="literal">Enhances</code> field also describes a suggestion, but in a different context. It is indeed located in the suggested package, and not in the package that benefits from the suggestion. Its interest lies in that it is possible to add a suggestion without having to modify the package that is concerned. Thus, all add-ons, plug-ins, and other extensions of a program can then take place in the list of suggestions related to the software. Although it has existed for several years, this last field is still largely ignored by programs such as <code class="command">apt-get</code> or <code class="command">synaptic</code>. Its purpose is for a suggestion made by the <code class="literal">Enhances</code> field to appear to the user in addition to the traditional suggestions — found in the <code class="literal">Suggests</code> field.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp4143656">5.2.1.2. Conflicts: the <code class="literal">Conflicts</code> field</h4></div></div></div><a id="idp4144280" class="indexterm"></a><a id="idp4144760" class="indexterm"></a><a id="idp4145384" class="indexterm"></a><div class="para"><p></p>
					The <code class="literal">Conflicts</code> field indicates when a package cannot be installed simultaneously with another. The most common reasons for this are that both packages include a file containing the same name, or provide the same service on the same TCP port, or would hinder each other's operation.
				</div><div class="para"><p></p>
					<code class="command">dpkg</code> will refuse to install a package if it triggers a conflict with an already installed package, except if the new package specifies that it will “replace” the installed packages, in which case <code class="command">dpkg</code> will choose to replace the old package with the new one. <code class="command">apt-get</code> always follows your instructions: if you choose to install a new package, it will automatically offer to uninstall the package that poses a problem.
				</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp4148272">5.2.1.3. Incompatibilities: the <code class="literal">Breaks</code> Field</h4></div></div></div><a id="idp4148896" class="indexterm"></a><a id="idp4149360" class="indexterm"></a><a id="idp4149984" class="indexterm"></a><div class="para"><p></p>
					The <code class="literal">Breaks</code> field has an effect similar to that of the <code class="literal">Conflicts</code> field, but with a special meaning. It signals that the installation of a package will “break” another package (or particular versions of it). In general, this incompatibility between two packages is transitory, and the <code class="literal">Breaks</code> relationship specifically refers to the incompatible versions.
				</div><div class="para"><p></p>
					<code class="command">dpkg</code> will refuse to install a package that breaks an already installed package, and <code class="command">apt-get</code> will try to resolve the problem by updating the package that would be broken to a newer version (which is assumed to be fixed and, thus, compatible again).
				</div><div class="para"><p></p>
					This type of situation may occur in the case of updates without backwards compatibility: this is the case if the new version no longer functions with the older version, and causes a malfunction in another program without making special provisions. The <code class="literal">Breaks</code> field prevents the user from running into these problems.
				</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp4153776">5.2.1.4. Provided Items: the <code class="literal">Provides</code> Field</h4></div></div></div><a id="idp4154400" class="indexterm"></a><div class="para"><p></p>
					This field introduces the very interesting concept of a “virtual package”. It has many roles, but two are of particular importance. The first role consists in using a virtual package to associate a generic service with it (the package “provides” the service). The second indicates that a package completely replaces another, and that for this purpose it can also satisfy the dependencies that the other would satisfy. It is thus possible to create a substitution package without having to use the same package name.
				</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>VOCABULARY</em></span> Meta-package and virtual package</h6></div></div></div><a id="idp4156376" class="indexterm"></a><a id="idp12789392" class="indexterm"></a><a id="idp12790096" class="indexterm"></a><div class="para"><p></p>
					It is essential to clearly distinguish meta-packages from virtual packages. The former are real packages (including real <code class="filename">.deb</code> files), whose only purpose is to express dependencies.
				</div><div class="para"><p></p>
					Virtual packages, however, do not exist physically; they are only a means of identifying real packages based on common, logical criteria (service provided, compatibility with a standard program or a pre-existing package, etc.).
				</div></div><div class="section"><div class="titlepage"><div><div><h5 class="title" id="idp12791768">5.2.1.4.1. Providing a “Service”</h5></div></div></div><div class="para"><p></p>
						Let us discuss the first case in greater detail with an example: all mail servers, such as <span class="pkg pkg">postfix</span> or <span class="pkg pkg">sendmail</span> are said to “provide” the <span class="pkg pkg">mail-transport-agent</span> virtual package. Thus, any package that needs this service to be functional (e.g. a mailing list manager, such as <span class="pkg pkg">smartlist</span> or <span class="pkg pkg">sympa</span>) simply states in its dependencies that it requires a <span class="pkg pkg">mail-transport-agent</span> instead of specifying a large yet incomplete list of possible solutions (e.g. <code class="command">postfix | sendmail | exim | …</code>). Furthermore, it is useless to install two mail servers on the same machine, which is why each of these packages declares a conflict with the <span class="pkg pkg">mail-transport-agent</span> virtual package. The conflict with itself is ignored by the system, but this technique will prohibit the installation of two mail servers side by side.
					</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>DEBIAN POLICY</em></span> List of virtual packages</h6></div></div></div><a id="idp12796504" class="indexterm"></a><div class="para"><p></p>
						For virtual packages to be useful, everyone must agree on their name. This is why they are standardized in the Debian Policy. The list includes among others <span class="pkg pkg">mail-transport-agent</span> for mail servers, <span class="pkg pkg">c-compiler</span> for C programming language compilers, <span class="pkg pkg">www-browser</span> for web browsers, <span class="pkg pkg">httpd</span> for web servers, <span class="pkg pkg">ftp-server</span> for FTP servers, <span class="pkg pkg">x-terminal-emulator</span> for terminal emulators in graphical mode (<code class="command">xterm</code> ), and <span class="pkg pkg">x-window-manager</span> for window managers.
					</div><div class="para"><p></p>
						The full list can be found on the Web, at <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt">http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt</a></div>
					</div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title" id="idp12801400">5.2.1.4.2. Interchangeability with Another Package</h5></div></div></div><div class="para"><p></p>
						The <code class="literal">Provides</code> field is again interesting when the content of a package is included in a larger package. For example, the <span class="pkg pkg">libdigest-md5-perl</span> Perl module was an optional module in Perl 5.6, and has been integrated as standard in Perl 5.8 (and later versions, such as 5.10 present in <span class="distribution distribution">Squeeze</span>). As such, the package <span class="pkg pkg">perl</span> has since version 5.8 declared <code class="literal">Provides: libdigest-md5-perl</code> so that the dependencies on this package are met if the user has Perl 5.8 or 5.10. The <span class="pkg pkg">libdigest-md5-perl</span> package itself has eventually been deleted, since it no longer had any purpose when old Perl versions were removed.
					</div><div class="figure"><div class="figure-contents"><div class="mediaobject"><img src="images/paquet-virtuel.png" alt="Use of a Provides field in order to not break dependencies" /></div></div><h6>Figure 5.1. Use of a <code class="literal">Provides</code> field in order to not break dependencies</h6></div><br class="figure-break" /><div class="para"><p></p>
						This feature is very useful, since it is never possible to anticipate the vagaries of development, and it is necessary to be able to adjust to renaming, and other automatic replacement, of obsolete software.
					</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>BACK TO BASICS</em></span> Perl, a programming language</h6></div></div></div><a id="idp12807296" class="indexterm"></a><a id="idp12807776" class="indexterm"></a><div class="para"><p></p>
						Perl (Practical Extraction and Report Language) is a very popular programming language. It has many ready-to-use modules that cover a vast spectrum of applications, and that are distributed by the CPAN (Comprehensive Perl Archive Network) servers, an exhaustive network of Perl packages. <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.perl.org/">http://www.perl.org/</a></div> <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.cpan.org/">http://www.cpan.org/</a></div>
					</div><div class="para"><p></p>
						Since it is an interpreted language, a program written in Perl does not require compilation prior to execution. This is why they are called “Perl scripts”.
					</div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title" id="idp12810248">5.2.1.4.3. Current Limitations</h5></div></div></div><div class="para"><p></p>
						Virtual packages suffer from some troubling limitations, the most significant of which being the absence of a version number. To return to the previous example, a dependency such as <code class="literal">Depends: libdigest-md5-perl (&gt;= 1.6)</code>, despite the presence of Perl 5.10, will never be considered as satisfied by the packaging system — while in fact it most likely is satisfied. Unaware of this, the package system chooses the least risky option, assuming that the versions do not match.
					</div><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> Virtual package versions</h6></div></div></div><div class="para"><p></p>
						Although today virtual packages can't have versions, this will not necessarily always be the case. Indeed, <code class="command">apt</code> is already able to manage the versions of virtual packages and it is likely that <code class="command">dpkg</code> eventually will too. We will then be able to write fields such as <code class="literal">Provides: libstorable-perl (= 1.7)</code> to indicate that a package provides the same functionality as <span class="pkg pkg">libstorable-perl</span> in its 1.7 version.
					</div></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp12814088">5.2.1.5. Replacing Files: The <code class="literal">Replaces</code> Field</h4></div></div></div><a id="idp12814712" class="indexterm"></a><a id="idp12815192" class="indexterm"></a><a id="idp12815816" class="indexterm"></a><div class="para"><p></p>
					The <code class="literal">Replaces</code> field indicates that the package contains files that are also present in another package, but that the package is legitimately entitled to replace them. Without this specification, <code class="command">dpkg</code> fails, stating that it can not overwrite the files of another package (in fact, it is possible to force it to do so with the <code class="literal">--force-overwrite</code> option). This allows identification of potential problems and requires the maintainer to study the matter prior to choosing whether to add such a field.
				</div><div class="para"><p></p>
					The use of this field is justified when package names change or when a package is included in another. This also happens when the maintainer decides to distribute files differently among various binary packages produced from the same source package: a replaced file no longer belongs to the old package, but only to the new one.
				</div><div class="para"><p></p>
					If all of the files in an installed package have been replaced, the package is considered to be removed. Finally, this field also encourages <code class="command">dpkg</code> to remove the replaced package where there is a conflict.
				</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> The <code class="literal">Tag</code> field</h6></div></div></div><div class="para"><p></p>
					In the <span class="pkg pkg">apt</span> example above, we can see the presence of a field that we have not yet described, the <code class="literal">Tag</code> field. This field does not describe a relationship between packages, but is simply a way of categorizing a package in a thematic taxonomy. This classification of packages according to several criteria (type of interface, programming language, domain of application, etc.) is a recent development in Debian. For this purpose, it is not yet integrated in all of its tools; <code class="command">aptitude</code> displays these tags, and allows them to be used as search criteria. For those who are repelled by <code class="command">aptitude</code>'s search criteria, the following site allows navigation of the tag database:<div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://debtags.alioth.debian.org/">http://debtags.alioth.debian.org/</a></div>
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp12822624">5.2.2. Configuration Scripts</h3></div></div></div><a id="idp12823008" class="indexterm"></a><a id="idp12823568" class="indexterm"></a><a id="idp12824128" class="indexterm"></a><a id="idp12824688" class="indexterm"></a><a id="idp12825248" class="indexterm"></a><div class="para"><p></p>
				In addition to the <code class="filename">control</code> file, the <code class="filename">control.tar.gz</code> archive for each Debian package may contain a number of scripts, called by <code class="command">dpkg</code> at different stages in the processing of a package. The Debian Policy describes the possible cases in detail, specifying the scripts called and the arguments that they receive. These sequences may be complicated, since if one of the scripts fails, <code class="command">dpkg</code> will try to return to a satisfactory state by canceling the installation or removal in progress (insofar as it is possible).
			</div><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> <code class="command">dpkg</code> data directory</h6></div></div></div><a id="idp12828312" class="indexterm"></a><div class="para"><p></p>
				All of the configuration scripts for installed packages are stored in the <code class="filename">/var/lib/dpkg/info/</code> directory, in the form of a file prefixed with the package's name. This directory also includes a file with the <code class="filename">.list</code> extension for each package, containing the list of files that belong to that package.
			</div><div class="para"><p></p>
				The <code class="filename">/var/lib/dpkg/status</code> file contains a series of data blocks (in the format of the famous mail headers, RFC 2822) describing the status of each package. The information from the <code class="filename">control</code> file of the installed packages is also replicated there.
			</div></div><div class="para"><p></p>
				In general, the <code class="filename">preinst</code> script is executed prior to installation of the package, while the <code class="filename">postinst</code> follows it. Likewise, <code class="filename">prerm</code> is invoked before removal of a package and <code class="filename">postrm</code> aftwards. An update of a package is equivalent to removal of the previous version and installation of the new one. It is not possible to describe in detail all the possible scenarios here, but we will discuss the most common two: an installation/update and a removal.
			</div><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>CAUTION</em></span> Symbolic names of the scripts</h6></div></div></div><div class="para"><p></p>
				The sequences described in this section call configuration scripts by specific names, such as <code class="command">old-prerm</code> or <code class="command">new-postinst</code>. They are, respectively, the <code class="command">prerm</code> script contained in the old version of the package (installed before the update) and the <code class="command">postinst</code> script contained in the new version (installed by the update).
			</div></div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TIP</em></span> State diagrams</h6></div></div></div><div class="para"><p></p>
				Manoj Srivastava made these diagrams explaining how the configuration scripts are called by <code class="command">dpkg</code>. Similar diagrams have also been developed by the Debian Women project; they are a bit simpler to understand, but less complete. <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://people.debian.org/~srivasta/MaintainerScripts.html">http://people.debian.org/~srivasta/MaintainerScripts.html</a></div> <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://wiki.debian.org/MaintainerScripts">http://wiki.debian.org/MaintainerScripts</a></div>
			</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp12836864">5.2.2.1. Installation and Upgrade</h4></div></div></div><div class="para"><p></p>
					Here is what happens during an installation (or an update):
				</div><div class="orderedlist"><ol><li class="listitem"><div class="para"><p></p>
							For an update, <code class="command">dpkg</code> calls the <code class="command">old-prerm upgrade <em class="replaceable"><code>new-version</code></em></code>.
						</div></li><li class="listitem"><div class="para"><p></p>
							Still for an update, <code class="command">dpkg</code> then executes <code class="command">new-preinst upgrade<em class="replaceable"><code>old-version</code></em></code>; for a first installation, it executes <code class="command">new-preinst install</code>. It may add the old version in the last parameter, if the package has already been installed and removed since (but not purged, the configuration files having been retained).
						</div></li><li class="listitem"><div class="para"><p></p>
							The new package files are then unpacked. If a file already exists, it is replaced, but a backup copy is temporarily made.
						</div></li><li class="listitem"><div class="para"><p></p>
							For an update, <code class="command">dpkg</code> executes <code class="command">old-postrm upgrade <em class="replaceable"><code>new-version</code></em></code>.
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">dpkg</code> updates all of the internal data (file list, configuration scripts, etc.) and removes the backups of the replaced files. This is the point of no return: <code class="command">dpkg</code> no longer has access to all of the elements necessary to return to the previous state.
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">dpkg</code> will update the configuration files, asking the user to decide if it is unable to automatically manage this task. The details of this procedure are discussed in <a class="xref" href="sect.package-meta-information.html#section.conffiles">Section 5.2.3, “Checksums, List of Configuration Files”</a>.
						</div></li><li class="listitem"><div class="para"><p></p>
							Finally, <code class="command">dpkg</code> configures the package by executing <code class="command">new-postinst configure <em class="replaceable"><code>last-version-configured</code></em></code>.
						</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="idp12845568">5.2.2.2. Package Removal</h4></div></div></div><div class="para"><p></p>
					Here is what happens during a package removal:
				</div><div class="orderedlist"><ol><li class="listitem"><div class="para"><p></p>
							<code class="command">dpkg</code> calls <code class="command">prerm remove</code>.
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">dpkg</code> removes all of the package's files, with the exception of the configuration files and configuration scripts.
						</div></li><li class="listitem"><div class="para"><p></p>
							<code class="command">dpkg</code> executes <code class="command">postrm remove</code>. All of the configuration scripts, except <code class="filename">postrm</code>, are removed. If the user has not used the “purge” option, the operations are completed there.
						</div></li><li class="listitem"><div class="para"><p></p>
							For a complete purge of the package (command issued with <code class="command">dpkg --purge</code> or <code class="command">dpkg -P</code>), the configuration files are also deleted, as well as a certain number of copies (<code class="filename">*.dpkg-tmp</code>, <code class="filename">*.dpkg-old</code>, <code class="filename">*.dpkg-new</code>) and temporary files; <code class="command">dpkg</code> then executes <code class="command">postrm purge</code>.
						</div></li></ol></div><a id="idp12851752" class="indexterm"></a><a id="idp12852376" class="indexterm"></a><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>VOCABULARY</em></span> Purge, complete removal</h6></div></div></div><a id="idp12648448" class="indexterm"></a><div class="para"><p></p>
					When a Debian package is removed, the configuration files are retained in order to facilitate possible re-installation. Likewise, the data generated by a daemon (such as the content of an LDAP server directory, or the content of a database for an SQL server) are usually retained.
				</div><div class="para"><p></p>
					To remove all data associated with a package, it is necessary to “purge” the package with the command, <code class="command">dpkg -P <em class="replaceable"><code>package</code></em></code>, <code class="command">apt-get remove --purge <em class="replaceable"><code>package</code></em></code> or <code class="command">aptitude purge <em class="replaceable"><code>package</code></em></code>.
				</div><div class="para"><p></p>
					Given the definitive nature of such data removal, purge should not be taken lightly.
				</div></div><div class="para"><p></p>
					The four scripts detailed below are complemented by a <code class="filename">config</code> script, provided by packages using <code class="command">debconf</code> to acquire information from the user for configuration. During installation, this script defines in detail the questions asked by <code class="command">debconf</code>. The responses are recorded in the <code class="command">debconf</code> database for future reference. The script is generally executed by <code class="command">apt</code> prior to installing packages one by one in order to group all the questions and ask them all to the user at the beginning of the process. The pre- and post-installation scripts can then use this information to operate according to the user's wishes.
				</div><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>TOOL</em></span> <code class="command">debconf</code></h6></div></div></div><a id="idp12654120" class="indexterm"></a><div class="para"><p></p>
					<code class="command">debconf</code> was created to resolve a recurring problem in Debian. All Debian packages unable to function without a minimum of configuration used to ask questions with calls to the <code class="command">echo</code> and <code class="command">read</code>commands in shell scripts such as <code class="filename">postinst</code> and similar scripts. But this also means that during a large installation or update the user must stay with their computer to respond to various questions that may arise at any time. These manual interactions have now been almost entirely dispensed with, thanks to the <code class="command">debconf</code> tool.
				</div><div class="para"><p></p>
					<code class="command">debconf</code> has many interesting features: it requires the developer to specify user interaction; it allows localization of various strings of characters posted (all translations are stored in the <code class="filename">templates</code> file describing the interactions); it has different display models for presenting the questions to the user (text mode, graphical mode, non-interactive); and it allows creation of a central database of responses to share the same configuration with several computers... but the most important is that it is now possible to present all of the questions in a block to the user prior to starting a long installation or update process. The user can go about their business while the system handles the installation on its own, without having to stay there staring at the screen waiting for questions.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="section.conffiles">5.2.3. Checksums, List of Configuration Files</h3></div></div></div><a id="idp12658816" class="indexterm"></a><a id="idp12659376" class="indexterm"></a><a id="idp12659936" class="indexterm"></a><a id="idp12660640" class="indexterm"></a><div class="para"><p></p>
				In addition to the configuration files mentioned in the previous sections, the <code class="filename">control.tar.gz</code> file in a Debian package contains others. The first, <code class="filename">md5sums</code>, contains the list of digital fingerprints for all of the package's files. Its main advantage is that it allows a tool such as <code class="command">debsums</code> (which we will study in <a class="xref" href="sect.supervision.html#section.debsums">Section 14.3.3.1, “Auditing Packages: <code class="command">debsums</code> and its Limits”</a>) to check if these files have been modified since their installation.
			</div><div class="para"><p></p>
				<code class="filename">conffiles</code> lists package files that must be handled as configuration files. This involves a special handling, since configuration files can be modified by the administrator, and the changes are usually preserved during a package update.
			</div><div class="para"><p></p>
				In effect, in this situation, <code class="command">dpkg</code> behaves as intelligently as possible: if the standard configuration file has not changed between the two versions, it does nothing. If, however, the file has changed, it will try to update this file. Two cases are possible: either the administrator has not touched this configuration file, in which case <code class="command">dpkg</code> automatically installs the new version; or the file has been modified, in which case <code class="command">dpkg</code> asks the administrator which version they wish to use (the old one with modifications, or the new one provided with the package). To assist in making this decision, <code class="command">dpkg</code> offers to display a “<code class="command">diff</code>” that shows the difference between the two versions. If the user chooses to retain the old version, the new one will be stored in the same location in a file with the <code class="filename">.dpkg-dist</code> suffix. If the user chooses the new version, the old one is retained in a file with the <code class="filename">.dpkg-old</code> suffix. Another available action consists of momentarily interrupting <code class="command">dpkg</code> to edit the file and attempt to re-instate the relevant modifications (previously identified with <code class="command">diff</code>).
			</div><div class="sidebar important"><a xmlns="" id="cadre.questions-conffiles"></a><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> Avoiding the configuration file questions</h6></div></div></div><div class="para"><p></p>
				<code class="command">dpkg</code> handles configuration file updates, but regularly interrupts these operations to ask for input from the administrator. This makes it less than enjoyable for those who wish to run updates in a non-interactive manner. This is why this program offers options that allow the system to respond automatically according to the same logic: <code class="command">--force-confold</code> retains the old version of the file; <code class="command">--force-confnew</code> wil use the new version of the file (these choices are respected, even if the file has not been changed by the administrator, which only rarely has the desired effect). Adding the <code class="command">--force-confdef</code> option tells <code class="command">dpkg</code> to use the default option when a choice is offered (in other words, when the original configuration file has not been touched), and only uses <code class="command">--force-confnew</code> or <code class="command">--force-confold</code> for other cases.
			</div><div class="para"><p></p>
				These options apply to <code class="command">dpkg</code>, but most of the time the administrator will work directly with the <code class="command">aptitude</code> or <code class="command">apt-get</code> programs. It is, thus, necessary to know the syntax used to indicate the options to pass to the <code class="command">dpkg</code> command (their command line interfaces are very similar).
			</div><pre class="screen">
<code class="computeroutput"># </code><strong class="userinput"><code>apt-get -o DPkg::Options::="--force-confdef" -o DPkg::options::="--force-confold" dist-upgrade</code></strong></pre><div class="para"><p></p>
				These options can be stored directly in the configuration for the <code class="command">apt</code> program, rather than specified them each time on the command line. To do so, simply write the following line in the <code class="filename">/etc/apt/apt.conf.d/local</code> file:
			</div><div class="informalexample"><pre class="programlisting">
DPkg::Options { "--force-confdef"; "--force-confold"; }
</pre></div><div class="para"><p></p>
				Including this option in the configuration file will allow it to also be used in a graphical interface such as <code class="command">aptitude</code>.
			</div></div><div class="sidebar"><a xmlns="" id="cadre.questions-conffiles-bis"></a><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> Force dpkg to ask configuration file questions</h6></div></div></div><div class="para"><p></p>
				The option, <code class="command">--force-confask</code> requires <code class="command">dpkg</code> to display the questions about the configuration files, even in cases where they would not normally be necessary. Thus, when reinstalling a package with this option, <code class="command">dpkg</code> will ask the questions again for all of the configuration files modified by the administrator. This is very convenient, especially for reinstalling the original configuration file if it has been deleted and no other copy is available: a normal re-installation won't work, because <code class="command">dpkg</code> considers removal as a form of legitimate modification, and, thus, doesn't install the desired configuration file.
			</div></div></div></div><div id="site_footer"></div><script type="text/javascript">
		$("#site_footer").load("../../../../../footer.html");
	</script><ul class="docnav"><li class="previous"><a accesskey="p" href="packaging-system.html"><strong>Prev</strong>Chapter 5. Packaging System: Tools and Fundamenta...</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="sect.source-package-structure.html"><strong>Next</strong>5.3. Structure of a Source Package</a></li></ul></body></html>
