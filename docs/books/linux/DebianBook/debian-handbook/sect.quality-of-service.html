<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>10.3. Quality of Service</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 3.0" /><meta name="package" content="Debian-debian-handbook-6.0-en-US-1.0-1" /><meta name="keywords" content="Network, Gateway, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link rel="home" href="index.html" title="The Debian Administrator's Handbook" /><link rel="up" href="network-infrastructure.html" title="Chapter 10. Network Infrastructure" /><link rel="prev" href="sect.virtual-private-network.html" title="10.2. Virtual Private Network" /><link rel="next" href="sect.dynamic-routing.html" title="10.4. Dynamic Routing" /></head><body><p class="hidden" id="title"><a class="left" href="http://www.debian.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://debian-handbook.info"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="sect.virtual-private-network.html"><strong>Prev</strong></a></li><li class="home">The Debian Administrator's Handbook</li><li class="next"><a accesskey="n" href="sect.dynamic-routing.html"><strong>Next</strong></a></li></ul><div class="section"><div class="titlepage"><div><div><h2 class="title" id="sect.quality-of-service">10.3. Quality of Service</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="section.qos-principe">10.3.1. Principle and Mechanism</h3></div></div></div><div class="para"><p></p>
				<span class="emphasis"><em>Quality of Service</em></span> (or <span class="emphasis"><em>QoS</em></span> for short) refers to a set of techniques that guarantee or improve the quality of the service provided to applications. The most popular such technique involves classifying the network traffic into categories, and differentiating the handling of traffic according to which category it belongs in. The main application of this differentiated services concept is <span class="emphasis"><em>traffic shaping</em></span>, which limits the data transmission rates for connections related to some services and/or hosts so as not to saturate the available bandwidth and starve important other services. Traffic shaping is a particularly good fit for TCP traffic, since this protocol automatically adapts to available bandwidth.
			</div><a id="idp9193560" class="indexterm"></a><a id="idp9194040" class="indexterm"></a><a id="idp9194504" class="indexterm"></a><a id="idp9195224" class="indexterm"></a><div class="para"><p></p>
				It is also possible to alter the priorities on traffic, which allows prioritizing packets related to interactive services (such as <code class="command">ssh</code> and <code class="command">telnet</code>) or to services that only deal with small blocks of data.
			</div><div class="para"><p></p>
				The Debian kernels include the features required for QoS along with their associated modules. These modules are many, and each of them provides a different service, most notably by way of special schedulers for the queues of IP packets; the wide range of available scheduler behaviors spans the whole range of possible requirements.
			</div><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>CULTURE</em></span> LARTC — <span class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span></h6></div></div></div><div class="para"><p></p>
				The <span class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span> HOWTO is the reference document covering everything there is to know about network quality of service. <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.linux-france.org/prj/inetdoc/guides/lartc/lartc.html">http://www.linux-france.org/prj/inetdoc/guides/lartc/lartc.html</a></div>
			</div><a id="idp9199208" class="indexterm"></a><a id="idp9199928" class="indexterm"></a><a id="idp9200392" class="indexterm"></a></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="section.qos-config">10.3.2. Configuring and Implementing</h3></div></div></div><div class="para"><p></p>
				QoS parameters are set through the <code class="command">tc</code> command (provided by the <span class="pkg pkg">iproute</span> package). Since its interface is quite complex, using higher-level tools is recommended.
			</div><a id="idp9202504" class="indexterm"></a><a id="idp9203064" class="indexterm"></a><div class="section"><div class="titlepage"><div><div><h4 class="title" id="section.qos-wondershaper">10.3.2.1. Reducing Latencies: <code class="command">wondershaper</code></h4></div></div></div><div class="para"><p></p>
					The main purpose of <code class="command">wondershaper</code> (in the similarly-named package) is to minimize latencies independent of network load. This is achieved by limiting total traffic to a value that falls just short of the link saturation value.
				</div><a id="idp9204928" class="indexterm"></a><a id="idp9205472" class="indexterm"></a><a id="idp9205936" class="indexterm"></a><div class="para"><p></p>
					Once a network interface is configured, setting up this traffic limitation is achieved by running <code class="command">wondershaper <em class="replaceable"><code>interface</code></em> <em class="replaceable"><code>download_rate</code></em> <em class="replaceable"><code>upload_rate</code></em></code>. The interface can be <code class="literal">eth0</code> or <code class="literal">ppp0</code> for example, and both rates are expressed in kilobits per second. The <code class="command">wondershaper remove <em class="replaceable"><code>interface</code></em></code> command disables traffic control on the specified interface.
				</div><div class="para"><p></p>
					For an Ethernet connection, this script is best called right after the interface is configured. This is done by adding <code class="literal">up</code> and <code class="literal">down</code> directives to the <code class="filename">/etc/network/interfaces</code> file allowing declared commands to be run, respectively, after the interface is configured and before it is deconfigured. For example:
				</div><div class="example"><h6>Example 10.9. Changes in the <code class="filename">/etc/network/interfaces</code> file</h6><div class="example-contents"><pre class="programlisting">
iface eth0 inet dhcp
    up /sbin/wondershaper eth0 500 100
    down /sbin/wondershaper remove eth0
</pre></div></div><br class="example-break" /><div class="para"><p></p>
					In the PPP case, creating a script that calls <code class="command">wondershaper</code> in <code class="filename">/etc/ppp/ip-up.d/</code> will enable traffic control as soon as the connection is up.
				</div><div class="sidebar fil"><div class="titlepage"><div><div><h6><span class="emphasis"><em>GOING FURTHER</em></span> Optimal configuration</h6></div></div></div><div class="para"><p></p>
					The <code class="filename">/usr/share/doc/wondershaper/README.Debian.gz</code> file describes, in some detail, the configuration method recommended by the package maintainer. In particular, it advises measuring the download and upload speeds so as to best evaluate real limits.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="section.qos-config-standard">10.3.2.2. Standard Configuration</h4></div></div></div><div class="para"><p></p>
					Barring a specific QoS configuration, the Linux kernel uses the <code class="literal">pfifo_fast</code> queue scheduler, which provides a few interesting features by itself. The priority of each processed IP packet is based on the ToS field (<span class="emphasis"><em>Type of Service</em></span>) of this packet; modifying this field is enough to take advantage of the scheduling features. There are five possible values:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para"><p></p>
							Normal-Service (0);
						</div></li><li class="listitem"><div class="para"><p></p>
							Minimize-Cost (2);
						</div></li><li class="listitem"><div class="para"><p></p>
							Maximize-Reliability (4);
						</div></li><li class="listitem"><div class="para"><p></p>
							Maximize-Throughput (8);
						</div></li><li class="listitem"><div class="para"><p></p>
							Minimize-Delay (16).
						</div></li></ul></div><a id="idp9217688" class="indexterm"></a><a id="idp9218168" class="indexterm"></a><div class="para"><p></p>
					The ToS field can be set by applications that generate IP packets, or modified on the fly by <span class="emphasis"><em>netfilter</em></span>. The following rules are sufficient to increase responsiveness for a server's SSH service:
				</div><pre class="programlisting scale">
iptables -t mangle -A PREROUTING -p tcp --sport ssh -j TOS --set-tos Minimize-Delay
iptables -t mangle -A PREROUTING -p tcp --dport ssh -j TOS --set-tos Minimize-Delay
</pre></div></div></div><div id="site_footer"></div><script type="text/javascript">
		$("#site_footer").load("../../../../../footer.html");
	</script><ul class="docnav"><li class="previous"><a accesskey="p" href="sect.virtual-private-network.html"><strong>Prev</strong>10.2. Virtual Private Network</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="sect.dynamic-routing.html"><strong>Next</strong>10.4. Dynamic Routing</a></li></ul></body></html>
