<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>11.6. HTTP/FTP Proxy</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 3.0" /><meta name="package" content="Debian-debian-handbook-6.0-en-US-1.0-1" /><meta name="keywords" content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP" /><link rel="home" href="index.html" title="The Debian Administrator's Handbook" /><link rel="up" href="network-services.html" title="Chapter 11. Network Services: Postfix, Apache, NFS, Samba, Squid, LDAP" /><link rel="prev" href="sect.windows-file-server-with-samba.html" title="11.5. Setting Up Windows Shares with Samba" /><link rel="next" href="sect.ldap-directory.html" title="11.7. LDAP Directory" /></head><body><p class="hidden" id="title"><a class="left" href="http://www.debian.org"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://debian-handbook.info"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="sect.windows-file-server-with-samba.html"><strong>Prev</strong></a></li><li class="home">The Debian Administrator's Handbook</li><li class="next"><a accesskey="n" href="sect.ldap-directory.html"><strong>Next</strong></a></li></ul><div class="section"><div class="titlepage"><div><div><h2 class="title" id="sect.http-ftp-proxy">11.6. HTTP/FTP Proxy</h2></div></div></div><div class="para"><p></p>
			An HTTP/FTP proxy acts as an intermediary for HTTP and/or FTP connections. Its role is twofold:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para"><p></p>
					Caching: recently downloaded documents are copied locally, which avoids multiple downloads.
				</div></li><li class="listitem"><div class="para"><p></p>
					Filtering server: if use of the proxy is mandated (and outgoing connections are blocked unless they go through the proxy), then the proxy can determine whether or not the request is to be granted.
				</div></li></ul></div><a id="idp11941872" class="indexterm"></a><a id="idp11942336" class="indexterm"></a><div class="para"><p></p>
			Falcot Corp selected Squid as their proxy server.
		</div><a id="idp11943104" class="indexterm"></a><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp11943584">11.6.1. Installing</h3></div></div></div><div class="para"><p></p>
				The <span class="pkg pkg">squid</span> Debian package only contains the modular (caching) proxy. Turning it into a filtering server requires installing the additional <span class="pkg pkg">squidguard</span> package. In addition, <span class="pkg pkg">squid-cgi</span> provides a querying and administration interface for a Squid proxy.
			</div><div class="para"><p></p>
				Prior to installing, care should be taken to check that the system can identify its own complete name: the <code class="command">hostname -f</code> must return a fully-qualified name (including a domain). If it does not, then the <code class="filename">/etc/hosts</code> file should be edited to contain the full name of the system (for instance, <code class="literal">arrakis.falcot.com</code>). The official computer name should be validated with the network administrator in order to avoid potential name conflicts.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp11946960">11.6.2. Configuring a Cache</h3></div></div></div><div class="para"><p></p>
				Enabling the caching server feature is a simple matter of editing the <code class="filename">/etc/squid/squid.conf</code> configuration file and allowing machines from the local network to run queries through the proxy. The following example shows the modifications made by the Falcot Corp administrators:
			</div><div class="example"><h6>Example 11.30. The <code class="filename">/etc/squid/squid.conf</code> file (excerpts)</h6><div class="example-contents"><pre class="programlisting">
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS

# Example rule allowing access from your local networks. Adapt
# to list your (internal) IP networks from where browsing should
# be allowed
acl our_networks src 192.168.1.0/24 192.168.2.0/24
http_access allow our_networks
http_access allow localhost
# And finally deny all other access to this proxy
http_access deny all
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="idp11949432">11.6.3. Configuring a Filter</h3></div></div></div><div class="para"><p></p>
				<code class="command">squid</code> itself does not perform the filtering; this action is delegated to <code class="command">squidGuard</code>. The former must then be configured to interact with the latter. This involves adding the following directive to the <code class="filename">/etc/squid/squid.conf</code> file:
			</div><a id="idp11950936" class="indexterm"></a><pre class="programlisting">
redirect_program /usr/bin/squidGuard -c /etc/squid/squidGuard.conf
</pre><div class="para"><p></p>
				The <code class="filename">/usr/lib/cgi-bin/squidGuard.cgi</code> CGI program also needs to be installed, using <code class="filename">/usr/share/doc/squidguard/examples/squidGuard.cgi.gz</code> as a starting point. Required modifications to this script are the <code class="varname">$proxy</code> and <code class="varname">$proxymaster</code> variables (the name of the proxy and the administrator's contact e-mail, respectively). The <code class="varname">$image</code> and <code class="varname">$redirect</code> variables should point to existing images representing the rejection of a query.
			</div><div class="para"><p></p>
				The filter is enabled with the <code class="command">/etc/init.d/squid reload</code> command. However, since the <span class="pkg pkg">squidguard</span> package does no filtering by default, it is the administrator's task to define the policy. This can be done by customizing the <code class="filename">/etc/squid/squidGuard.conf</code> file.
			</div><div class="para"><p></p>
				The working database must be regenerated with <code class="command">update-squidguard</code> after each change of the <code class="command">squidGuard</code> configuration file (or one of the lists of domains or URLs it mentions). The configuration file syntax is documented on the following website: <div xmlns="" class="url">→ <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.squidguard.org/Doc/configure.html">http://www.squidguard.org/Doc/configure.html</a></div>
			</div><a id="idp11956416" class="indexterm"></a><div class="sidebar"><div class="titlepage"><div><div><h6><span class="emphasis"><em>ALTERNATIVE</em></span> DansGuardian</h6></div></div></div><a id="idp11957504" class="indexterm"></a><a id="idp11958200" class="indexterm"></a><div class="para"><p></p>
				The <span class="pkg pkg">dansguardian</span> package is an alternative to <span class="emphasis"><em>squidguard</em></span>. This software does not simply handle a black-list of forbidden URLs, but it can take advantage of the PICS system (<span class="emphasis"><em>Platform for Internet Content Selection</em></span>) to decide whether a page is acceptable by dynamic analysis of its contents.
			</div></div></div></div><div id="site_footer"></div><script type="text/javascript">
		$("#site_footer").load("../../../../../footer.html");
	</script><ul class="docnav"><li class="previous"><a accesskey="p" href="sect.windows-file-server-with-samba.html"><strong>Prev</strong>11.5. Setting Up Windows Shares with Samba</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="sect.ldap-directory.html"><strong>Next</strong>11.7. LDAP Directory</a></li></ul></body></html>
